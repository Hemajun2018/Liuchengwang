<!-- Generated by SpecStory -->

# 项目框架设计讨论 (2025-03-09 11:17:03)

_**User**_

@需求文档 @技术栈 请根据需求文档和技术证帮我 设计整个项目的框架

---

_**Assistant**_

<thinking>
好的，我需要根据提供的需求文档和技术栈来设计整个项目的框架。让我先梳理一下关键信息。

从需求文档中，我了解到这是一个企业内部项目流程管理工具，有两个主要部分：
1. Web端后台管理系统 - 给管理员使用，用于创建和管理项目
2. 小程序端 - 给员工使用，用于查看项目信息

从技术栈文档中，我看到了推荐的技术方案：
1. 后台管理系统：Vue3 + TypeScript + Element Plus + Vite + Pinia + Vue Router
2. 小程序端：微信小程序原生开发 + TypeScript + Vant Weapp + Canvas/F2 + MobX
3. 后端服务：NestJS + MySQL + Redis + TypeORM + RESTful API
4. 基础设施：腾讯云 + Docker + GitHub Actions + Sentry/ELK + 腾讯云WAF

现在我需要设计整个项目的框架，包括：
1. 项目结构
2. 数据库设计
3. API接口设计
4. 前端页面结构
5. 小程序页面结构

让我开始设计这个框架。

## 项目结构
我会将项目分为三个主要部分：
1. 后端服务 (backend)
2. 管理后台 (admin)
3. 小程序 (miniprogram)

这样的分离可以让每个部分独立开发和部署。

## 数据库设计
根据需求，我需要设计以下几个主要的数据表：

1. 用户表 (users)
2. 项目表 (projects)
3. 节点表 (nodes)
4. 问题表 (issues)
5. 材料表 (materials)

让我详细设计每个表的结构。

## API接口设计
我需要设计RESTful API接口来支持前后端交互，主要包括：
1. 用户认证相关接口
2. 项目管理相关接口
3. 节点管理相关接口
4. 问题和材料管理相关接口

## 前端页面结构
后台管理系统需要设计以下页面：
1. 登录页
2. 项目列表页
3. 项目创建/编辑页
4. 节点管理页
5. 问题和材料管理页

## 小程序页面结构
小程序需要设计以下页面：
1. 登录页
2. 项目搜索页
3. 流程图展示页
4. 前置条件详情页
5. 材料详情页
6. 问题详情页
7. 成果展示页

现在让我开始详细设计这个框架。
</thinking>

# 流程王项目框架设计

## 一、项目整体架构

### 1. 三层架构设计
```
流程王项目
├── 前端层
│   ├── 管理后台（Web端）
│   └── 员工端（小程序）
├── 服务层
│   └── NestJS后端服务
└── 数据层
    ├── MySQL数据库
    └── Redis缓存
```

### 2. 项目代码仓库结构
```
liuchengwang/
├── backend/           # NestJS后端服务
├── admin/             # Vue3管理后台
└── miniprogram/       # 微信小程序
```

## 二、数据库设计

### 1. 核心数据表

#### 用户表 (users)
```sql
CREATE TABLE `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(100) NOT NULL COMMENT '密码（加密存储）',
  `real_name` varchar(50) DEFAULT NULL COMMENT '真实姓名',
  `role` enum('admin','employee') NOT NULL DEFAULT 'employee' COMMENT '角色',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像URL',
  `phone` varchar(20) DEFAULT NULL COMMENT '手机号',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态：1-启用，0-禁用',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

#### 项目表 (projects)
```sql
CREATE TABLE `projects` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL COMMENT '项目名称',
  `deliverables` text NOT NULL COMMENT '需交付内容',
  `start_date` date NOT NULL COMMENT '项目开始时间',
  `days_required` int NOT NULL COMMENT '需要完成天数',
  `expected_end_date` date NOT NULL COMMENT '预计完成日期',
  `status` enum('not_started','in_progress','completed','delayed') NOT NULL COMMENT '完成状态',
  `access_password` varchar(100) NOT NULL COMMENT '项目查询密码',
  `created_by` int NOT NULL COMMENT '创建人ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`),
  KEY `idx_status` (`status`),
  KEY `idx_created_by` (`created_by`),
  CONSTRAINT `fk_projects_users` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目表';
```

#### 节点表 (nodes)
```sql
CREATE TABLE `nodes` (
  `id` int NOT NULL AUTO_INCREMENT,
  `project_id` int NOT NULL COMMENT '所属项目ID',
  `name` varchar(100) NOT NULL COMMENT '节点名称',
  `description` text COMMENT '节点描述',
  `order` int NOT NULL COMMENT '节点顺序',
  `status` enum('not_started','in_progress','completed') NOT NULL DEFAULT 'not_started' COMMENT '节点状态',
  `expected_end_date` date DEFAULT NULL COMMENT '预计完成日期',
  `actual_end_date` date DEFAULT NULL COMMENT '实际完成日期',
  `node_type` enum('prerequisite','normal','result') NOT NULL DEFAULT 'normal' COMMENT '节点类型：前置条件/普通节点/成果',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_project_id` (`project_id`),
  KEY `idx_order` (`order`),
  CONSTRAINT `fk_nodes_projects` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='节点表';
```

#### 问题表 (issues)
```sql
CREATE TABLE `issues` (
  `id` int NOT NULL AUTO_INCREMENT,
  `node_id` int NOT NULL COMMENT '所属节点ID',
  `description` text NOT NULL COMMENT '问题描述',
  `status` enum('pending','resolved') NOT NULL DEFAULT 'pending' COMMENT '问题状态',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_node_id` (`node_id`),
  CONSTRAINT `fk_issues_nodes` FOREIGN KEY (`node_id`) REFERENCES `nodes` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='问题表';
```

#### 材料表 (materials)
```sql
CREATE TABLE `materials` (
  `id` int NOT NULL AUTO_INCREMENT,
  `node_id` int NOT NULL COMMENT '所属节点ID',
  `name` varchar(100) NOT NULL COMMENT '材料名称',
  `description` text COMMENT '材料说明',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_node_id` (`node_id`),
  CONSTRAINT `fk_materials_nodes` FOREIGN KEY (`node_id`) REFERENCES `nodes` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='材料表';
```

## 三、后端服务架构 (NestJS)

### 1. 目录结构
```
backend/
├── src/
│   ├── main.ts                    # 应用入口
│   ├── app.module.ts              # 根模块
│   ├── config/                    # 配置文件
│   ├── common/                    # 公共模块
│   │   ├── decorators/           # 自定义装饰器
│   │   ├── filters/              # 异常过滤器
│   │   ├── guards/               # 守卫
│   │   ├── interceptors/         # 拦截器
│   │   ├── middlewares/          # 中间件
│   │   └── pipes/                # 管道
│   ├── modules/                   # 功能模块
│   │   ├── auth/                 # 认证模块
│   │   ├── users/                # 用户模块
│   │   ├── projects/             # 项目模块
│   │   ├── nodes/                # 节点模块
│   │   ├── issues/               # 问题模块
│   │   └── materials/            # 材料模块
│   └── database/                  # 数据库相关
│       ├── entities/             # 实体类
│       ├── migrations/           # 数据库迁移
│       └── seeds/                # 种子数据
├── test/                          # 测试文件
├── nest-cli.json                  # NestJS配置
├── package.json                   # 依赖管理
└── tsconfig.json                  # TypeScript配置
```

### 2. 核心API接口设计

#### 认证相关接口
- `POST /api/auth/login` - 管理员登录
- `POST /api/auth/mini-login` - 小程序员工登录
- `POST /api/auth/logout` - 退出登录
- `GET /api/auth/profile` - 获取当前用户信息

#### 项目相关接口
- `GET /api/projects` - 获取项目列表
- `GET /api/projects/:id` - 获取项目详情
- `POST /api/projects` - 创建项目
- `PUT /api/projects/:id` - 更新项目
- `DELETE /api/projects/:id` - 删除项目
- `POST /api/projects/verify-password` - 验证项目密码

#### 节点相关接口
- `GET /api/projects/:projectId/nodes` - 获取项目节点列表
- `GET /api/nodes/:id` - 获取节点详情
- `POST /api/projects/:projectId/nodes` - 创建节点
- `PUT /api/nodes/:id` - 更新节点
- `DELETE /api/nodes/:id` - 删除节点

#### 问题相关接口
- `GET /api/nodes/:nodeId/issues` - 获取节点问题列表
- `POST /api/nodes/:nodeId/issues` - 创建问题
- `PUT /api/issues/:id` - 更新问题
- `DELETE /api/issues/:id` - 删除问题

#### 材料相关接口
- `GET /api/nodes/:nodeId/materials` - 获取节点材料列表
- `POST /api/nodes/:nodeId/materials` - 创建材料
- `PUT /api/materials/:id` - 更新材料
- `DELETE /api/materials/:id` - 删除材料

## 四、管理后台架构 (Vue3)

### 1. 目录结构
```
admin/
├── public/                        # 静态资源
├── src/
│   ├── main.ts                    # 应用入口
│   ├── App.vue                    # 根组件
│   ├── assets/                    # 资源文件
│   ├── components/                # 公共组件
│   │   ├── common/               # 通用组件
│   │   ├── layout/               # 布局组件
│   │   └── business/             # 业务组件
│   ├── router/                    # 路由配置
│   ├── store/                     # Pinia状态管理
│   │   ├── modules/              # 状态模块
│   │   └── index.ts              # 状态入口
│   ├── views/                     # 页面视图
│   │   ├── login/                # 登录页
│   │   ├── dashboard/            # 仪表盘
│   │   ├── projects/             # 项目管理
│   │   ├── nodes/                # 节点管理
│   │   ├── issues/               # 问题管理
│   │   └── materials/            # 材料管理
│   ├── api/                       # API请求
│   ├── utils/                     # 工具函数
│   ├── hooks/                     # 自定义Hooks
│   └── types/                     # TypeScript类型定义
├── vite.config.ts                 # Vite配置
├── package.json                   # 依赖管理
└── tsconfig.json                  # TypeScript配置
```

### 2. 页面结构设计

#### 登录页
- 用户名/密码登录表单
- 记住密码功能
- 登录状态验证

#### 项目管理页面
- 项目列表（表格展示）
  - 项目名称、开始时间、预计完成日期、状态等字段
  - 搜索、筛选、排序功能
  - 创建、编辑、删除操作
- 项目创建/编辑表单
  - 项目基本信息填写
  - 项目密码设置

#### 节点管理页面
- 节点列表（可拖拽排序）
  - 节点名称、状态、预计完成日期等字段
  - 添加、编辑、删除操作
- 节点创建/编辑表单
  - 节点基本信息填写
  - 节点类型选择（前置条件/普通节点/成果）

#### 问题管理页面
- 问题列表（按节点分组）
  - 问题描述、状态等字段
  - 添加、编辑、删除操作
- 问题创建/编辑表单

#### 材料管理页面
- 材料列表（按节点分组）
  - 材料名称、描述等字段
  - 添加、编辑、删除操作
- 材料创建/编辑表单

## 五、小程序架构

### 1. 目录结构
```
miniprogram/
├── app.js                         # 小程序入口
├── app.json                       # 全局配置
├── app.wxss                       # 全局样式
├── project.config.json            # 项目配置
├── sitemap.json                   # 微信索引配置
├── components/                    # 自定义组件
│   ├── common/                   # 通用组件
│   └── business/                 # 业务组件
├── pages/                         # 页面
│   ├── login/                    # 登录页
│   ├── index/                    # 首页（搜索页）
│   ├── project-flow/             # 流程图页面
│   ├── prerequisite/             # 前置条件详情页
│   ├── material/                 # 材料详情页
│   ├── issue/                    # 问题详情页
│   └── result/                   # 成果展示页
├── services/                      # API服务
├── store/                         # MobX状态管理
├── utils/                         # 工具函数
├── config/                        # 配置文件
└── assets/                        # 资源文件
```

### 2. 页面结构设计

#### 登录页
- 企业账号登录表单
- 微信授权登录

#### 首页（搜索页）
- 顶部搜索框
- 最近访问项目列表
- 项目搜索结果列表

#### 流程图页面
- 顶部：项目名称、整体进度条
- 主体：流程图展示
  - 节点卡片（可折叠/展开）
  - 节点状态指示
  - 问题/材料入口
- 底部：成果展示区（最终节点）

#### 前置条件详情页
- 项目基本信息展示
  - 项目名称
  - 需交付内容
  - 开始时间
  - 需要完成天数
  - 预计完成日期
  - 完成状态

#### 材料详情页
- 项目基本信息
- 所属节点信息
- 材料列表展示

#### 问题详情页
- 项目基本信息
- 所属节点信息
- 问题列表展示

#### 成果展示页
- 顶部横幅
- 成果列表展示

## 六、部署架构

### 1. 开发环境
- 本地开发环境
- 开发服务器环境

### 2. 生产环境
```
生产环境架构
├── 腾讯云轻量应用服务器
│   ├── Docker容器
│   │   ├── NestJS后端服务容器
│   │   ├── MySQL数据库容器
│   │   └── Redis缓存容器
│   └── Nginx反向代理
├── 腾讯云对象存储COS
│   └── 静态资源存储
└── 腾讯云Web应用防火墙
    └── 安全防护
```

### 3. CI/CD流程
- GitHub Actions自动化构建
- 自动化测试
- 自动化部署

## 七、安全设计

### 1. 认证与授权
- JWT令牌认证
- 基于角色的访问控制
- 项目密码验证机制

### 2. 数据安全
- 密码加密存储
- 敏感数据加密传输
- SQL注入防护
- XSS攻击防护

### 3. 监控与日志
- Sentry前端异常监控
- ELK服务端日志分析
- 关键操作审计日志

## 八、扩展性设计

### 1. 模块化设计
- 功能模块独立封装
- 接口标准化

### 2. 未来扩展方向
- 文件上传功能
- 消息通知系统
- 数据分析报表
- 移动端APP

以上就是流程王项目的整体框架设计，包含了数据库设计、后端服务架构、前端管理后台架构、小程序架构以及部署方案。这个设计基于需求文档和技术栈推荐方案，可以满足企业内部项目流程管理的需求。

---

_**User**_

代码仓库只有这几个吗？ 前端是不是没写， 我不太懂，你说呢liuchengwang/
├── backend/           # NestJS后端服务
├── admin/             # Vue3管理后台
└── miniprogram/       # 微信小程序

---

_**Assistant**_

<thinking>
我需要检查一下我之前提供的代码仓库结构是否完整。

在我之前的回答中，我确实列出了三个主要的代码仓库：
1. backend/ - NestJS后端服务
2. admin/ - Vue3管理后台
3. miniprogram/ - 微信小程序

用户提出疑问，认为前端可能没有写完整。让我分析一下：

在这个项目中，前端实际上分为两部分：
1. admin/ - 这是管理员使用的Web端后台管理系统，使用Vue3开发
2. miniprogram/ - 这是员工使用的微信小程序端

所以从技术上讲，前端确实已经包含在这个结构中了。admin/目录就是Web前端部分，miniprogram/目录是小程序前端部分。

不过，我可能需要更清晰地解释这一点，并确认这个结构是否足够完整。我还应该考虑是否需要添加其他可能的目录，比如：
- docs/ - 项目文档
- scripts/ - 部署脚本或其他工具脚本
- shared/ - 前后端共享的代码或类型定义
- .github/ - GitHub Actions配置等

让我给用户一个更完整的解释。
</thinking>

您提出了一个很好的问题！我在之前的回答中确实只列出了三个主要代码仓库，让我来解释一下并补充完整：

这三个目录其实已经包含了所有的前端和后端代码：
- `backend/` - NestJS后端服务
- `admin/` - Vue3管理后台（这就是Web端前端部分）
- `miniprogram/` - 微信小程序（这是另一个前端部分）

但是为了使项目结构更加完整和专业，我建议添加以下几个目录：

```
liuchengwang/
├── backend/           # NestJS后端服务
├── admin/             # Vue3管理后台（Web前端）
├── miniprogram/       # 微信小程序（小程序前端）
├── docs/              # 项目文档
│   ├── api/           # API文档
│   ├── database/      # 数据库设计文档
│   └── guides/        # 开发指南和使用手册
├── scripts/           # 部署脚本和工具脚本
│   ├── deploy/        # 部署相关脚本
│   └── db/            # 数据库初始化脚本
├── shared/            # 前后端共享代码
│   └── types/         # 共享的TypeScript类型定义
└── .github/           # GitHub配置
    └── workflows/     # GitHub Actions工作流配置
```

这样的结构会更加完整，方便团队协作和项目维护。

在这个项目中，前端实际上分为两部分：
1. `admin/` 目录 - 这是管理员使用的Web端后台管理系统（使用Vue3开发）
2. `miniprogram/` 目录 - 这是员工使用的微信小程序端

所以前端代码确实已经包含在这个结构中了，只是分为了Web前端和小程序前端两部分。

您觉得这样的结构合理吗？或者您有其他特定的需求需要考虑？

---

_**User**_

好的，请把以上整个项目结构都写到一个Markdown文档中

---

_**Assistant**_

<thinking>
我需要将整个项目结构整理成一个完整的Markdown文档。我将包括之前设计的所有内容，包括：

1. 项目整体架构
2. 代码仓库结构（包括刚刚补充的完整结构）
3. 数据库设计
4. 后端服务架构
5. 管理后台架构
6. 小程序架构
7. 部署架构
8. 安全设计
9. 扩展性设计

我会将这些内容组织成一个结构清晰的Markdown文档，使用适当的标题层级和格式。
</thinking>

我将创建一个包含整个项目结构的Markdown文档。

---



---



---

_**User**_

好了，你不要创建了，你直接发给我，我自己来创建

---

_**Assistant**_

<thinking>
明白了，用户希望我直接提供Markdown文档的内容，而不是通过工具创建文件。我将直接在回复中提供完整的Markdown文档内容，用户可以自行复制并创建文件。
</thinking>

# 流程王项目架构设计文档

## 一、项目整体架构

### 1. 三层架构设计
```
流程王项目
├── 前端层
│   ├── 管理后台（Web端）
│   └── 员工端（小程序）
├── 服务层
│   └── NestJS后端服务
└── 数据层
    ├── MySQL数据库
    └── Redis缓存
```

### 2. 项目代码仓库结构
```
liuchengwang/
├── backend/           # NestJS后端服务
├── admin/             # Vue3管理后台（Web前端）
├── miniprogram/       # 微信小程序（小程序前端）
├── docs/              # 项目文档
│   ├── api/           # API文档
│   ├── database/      # 数据库设计文档
│   └── guides/        # 开发指南和使用手册
├── scripts/           # 部署脚本和工具脚本
│   ├── deploy/        # 部署相关脚本
│   └── db/            # 数据库初始化脚本
├── shared/            # 前后端共享代码
│   └── types/         # 共享的TypeScript类型定义
└── .github/           # GitHub配置
    └── workflows/     # GitHub Actions工作流配置
```

## 二、数据库设计

### 1. 核心数据表

#### 用户表 (users)
```sql
CREATE TABLE `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(100) NOT NULL COMMENT '密码（加密存储）',
  `real_name` varchar(50) DEFAULT NULL COMMENT '真实姓名',
  `role` enum('admin','employee') NOT NULL DEFAULT 'employee' COMMENT '角色',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像URL',
  `phone` varchar(20) DEFAULT NULL COMMENT '手机号',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态：1-启用，0-禁用',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

#### 项目表 (projects)
```sql
CREATE TABLE `projects` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL COMMENT '项目名称',
  `deliverables` text NOT NULL COMMENT '需交付内容',
  `start_date` date NOT NULL COMMENT '项目开始时间',
  `days_required` int NOT NULL COMMENT '需要完成天数',
  `expected_end_date` date NOT NULL COMMENT '预计完成日期',
  `status` enum('not_started','in_progress','completed','delayed') NOT NULL COMMENT '完成状态',
  `access_password` varchar(100) NOT NULL COMMENT '项目查询密码',
  `created_by` int NOT NULL COMMENT '创建人ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`),
  KEY `idx_status` (`status`),
  KEY `idx_created_by` (`created_by`),
  CONSTRAINT `fk_projects_users` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目表';
```

#### 节点表 (nodes)
```sql
CREATE TABLE `nodes` (
  `id` int NOT NULL AUTO_INCREMENT,
  `project_id` int NOT NULL COMMENT '所属项目ID',
  `name` varchar(100) NOT NULL COMMENT '节点名称',
  `description` text COMMENT '节点描述',
  `order` int NOT NULL COMMENT '节点顺序',
  `status` enum('not_started','in_progress','completed') NOT NULL DEFAULT 'not_started' COMMENT '节点状态',
  `expected_end_date` date DEFAULT NULL COMMENT '预计完成日期',
  `actual_end_date` date DEFAULT NULL COMMENT '实际完成日期',
  `node_type` enum('prerequisite','normal','result') NOT NULL DEFAULT 'normal' COMMENT '节点类型：前置条件/普通节点/成果',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_project_id` (`project_id`),
  KEY `idx_order` (`order`),
  CONSTRAINT `fk_nodes_projects` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='节点表';
```

#### 问题表 (issues)
```sql
CREATE TABLE `issues` (
  `id` int NOT NULL AUTO_INCREMENT,
  `node_id` int NOT NULL COMMENT '所属节点ID',
  `description` text NOT NULL COMMENT '问题描述',
  `status` enum('pending','resolved') NOT NULL DEFAULT 'pending' COMMENT '问题状态',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_node_id` (`node_id`),
  CONSTRAINT `fk_issues_nodes` FOREIGN KEY (`node_id`) REFERENCES `nodes` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='问题表';
```

#### 材料表 (materials)
```sql
CREATE TABLE `materials` (
  `id` int NOT NULL AUTO_INCREMENT,
  `node_id` int NOT NULL COMMENT '所属节点ID',
  `name` varchar(100) NOT NULL COMMENT '材料名称',
  `description` text COMMENT '材料说明',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_node_id` (`node_id`),
  CONSTRAINT `fk_materials_nodes` FOREIGN KEY (`node_id`) REFERENCES `nodes` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='材料表';
```

## 三、后端服务架构 (NestJS)

### 1. 目录结构
```
backend/
├── src/
│   ├── main.ts                    # 应用入口
│   ├── app.module.ts              # 根模块
│   ├── config/                    # 配置文件
│   ├── common/                    # 公共模块
│   │   ├── decorators/           # 自定义装饰器
│   │   ├── filters/              # 异常过滤器
│   │   ├── guards/               # 守卫
│   │   ├── interceptors/         # 拦截器
│   │   ├── middlewares/          # 中间件
│   │   └── pipes/                # 管道
│   ├── modules/                   # 功能模块
│   │   ├── auth/                 # 认证模块
│   │   ├── users/                # 用户模块
│   │   ├── projects/             # 项目模块
│   │   ├── nodes/                # 节点模块
│   │   ├── issues/               # 问题模块
│   │   └── materials/            # 材料模块
│   └── database/                  # 数据库相关
│       ├── entities/             # 实体类
│       ├── migrations/           # 数据库迁移
│       └── seeds/                # 种子数据
├── test/                          # 测试文件
├── nest-cli.json                  # NestJS配置
├── package.json                   # 依赖管理
└── tsconfig.json                  # TypeScript配置
```

### 2. 核心API接口设计

#### 认证相关接口
- `POST /api/auth/login` - 管理员登录
- `POST /api/auth/mini-login` - 小程序员工登录
- `POST /api/auth/logout` - 退出登录
- `GET /api/auth/profile` - 获取当前用户信息

#### 项目相关接口
- `GET /api/projects` - 获取项目列表
- `GET /api/projects/:id` - 获取项目详情
- `POST /api/projects` - 创建项目
- `PUT /api/projects/:id` - 更新项目
- `DELETE /api/projects/:id` - 删除项目
- `POST /api/projects/verify-password` - 验证项目密码

#### 节点相关接口
- `GET /api/projects/:projectId/nodes` - 获取项目节点列表
- `GET /api/nodes/:id` - 获取节点详情
- `POST /api/projects/:projectId/nodes` - 创建节点
- `PUT /api/nodes/:id` - 更新节点
- `DELETE /api/nodes/:id` - 删除节点

#### 问题相关接口
- `GET /api/nodes/:nodeId/issues` - 获取节点问题列表
- `POST /api/nodes/:nodeId/issues` - 创建问题
- `PUT /api/issues/:id` - 更新问题
- `DELETE /api/issues/:id` - 删除问题

#### 材料相关接口
- `GET /api/nodes/:nodeId/materials` - 获取节点材料列表
- `POST /api/nodes/:nodeId/materials` - 创建材料
- `PUT /api/materials/:id` - 更新材料
- `DELETE /api/materials/:id` - 删除材料

## 四、管理后台架构 (Vue3)

### 1. 目录结构
```
admin/
├── public/                        # 静态资源
├── src/
│   ├── main.ts                    # 应用入口
│   ├── App.vue                    # 根组件
│   ├── assets/                    # 资源文件
│   ├── components/                # 公共组件
│   │   ├── common/               # 通用组件
│   │   ├── layout/               # 布局组件
│   │   └── business/             # 业务组件
│   ├── router/                    # 路由配置
│   ├── store/                     # Pinia状态管理
│   │   ├── modules/              # 状态模块
│   │   └── index.ts              # 状态入口
│   ├── views/                     # 页面视图
│   │   ├── login/                # 登录页
│   │   ├── dashboard/            # 仪表盘
│   │   ├── projects/             # 项目管理
│   │   ├── nodes/                # 节点管理
│   │   ├── issues/               # 问题管理
│   │   └── materials/            # 材料管理
│   ├── api/                       # API请求
│   ├── utils/                     # 工具函数
│   ├── hooks/                     # 自定义Hooks
│   └── types/                     # TypeScript类型定义
├── vite.config.ts                 # Vite配置
├── package.json                   # 依赖管理
└── tsconfig.json                  # TypeScript配置
```

### 2. 页面结构设计

#### 登录页
- 用户名/密码登录表单
- 记住密码功能
- 登录状态验证

#### 项目管理页面
- 项目列表（表格展示）
  - 项目名称、开始时间、预计完成日期、状态等字段
  - 搜索、筛选、排序功能
  - 创建、编辑、删除操作
- 项目创建/编辑表单
  - 项目基本信息填写
  - 项目密码设置

#### 节点管理页面
- 节点列表（可拖拽排序）
  - 节点名称、状态、预计完成日期等字段
  - 添加、编辑、删除操作
- 节点创建/编辑表单
  - 节点基本信息填写
  - 节点类型选择（前置条件/普通节点/成果）

#### 问题管理页面
- 问题列表（按节点分组）
  - 问题描述、状态等字段
  - 添加、编辑、删除操作
- 问题创建/编辑表单

#### 材料管理页面
- 材料列表（按节点分组）
  - 材料名称、描述等字段
  - 添加、编辑、删除操作
- 材料创建/编辑表单

## 五、小程序架构

### 1. 目录结构
```
miniprogram/
├── app.js                         # 小程序入口
├── app.json                       # 全局配置
├── app.wxss                       # 全局样式
├── project.config.json            # 项目配置
├── sitemap.json                   # 微信索引配置
├── components/                    # 自定义组件
│   ├── common/                   # 通用组件
│   └── business/                 # 业务组件
├── pages/                         # 页面
│   ├── login/                    # 登录页
│   ├── index/                    # 首页（搜索页）
│   ├── project-flow/             # 流程图页面
│   ├── prerequisite/             # 前置条件详情页
│   ├── material/                 # 材料详情页
│   ├── issue/                    # 问题详情页
│   └── result/                   # 成果展示页
├── services/                      # API服务
├── store/                         # MobX状态管理
├── utils/                         # 工具函数
├── config/                        # 配置文件
└── assets/                        # 资源文件
```

### 2. 页面结构设计

#### 登录页
- 企业账号登录表单
- 微信授权登录

#### 首页（搜索页）
- 顶部搜索框
- 最近访问项目列表
- 项目搜索结果列表

#### 流程图页面
- 顶部：项目名称、整体进度条
- 主体：流程图展示
  - 节点卡片（可折叠/展开）
  - 节点状态指示
  - 问题/材料入口
- 底部：成果展示区（最终节点）

#### 前置条件详情页
- 项目基本信息展示
  - 项目名称
  - 需交付内容
  - 开始时间
  - 需要完成天数
  - 预计完成日期
  - 完成状态

#### 材料详情页
- 项目基本信息
- 所属节点信息
- 材料列表展示

#### 问题详情页
- 项目基本信息
- 所属节点信息
- 问题列表展示

#### 成果展示页
- 顶部横幅
- 成果列表展示

## 六、部署架构

### 1. 开发环境
- 本地开发环境
- 开发服务器环境

### 2. 生产环境
```
生产环境架构
├── 腾讯云轻量应用服务器
│   ├── Docker容器
│   │   ├── NestJS后端服务容器
│   │   ├── MySQL数据库容器
│   │   └── Redis缓存容器
│   └── Nginx反向代理
├── 腾讯云对象存储COS
│   └── 静态资源存储
└── 腾讯云Web应用防火墙
    └── 安全防护
```

### 3. CI/CD流程
- GitHub Actions自动化构建
- 自动化测试
- 自动化部署

## 七、安全设计

### 1. 认证与授权
- JWT令牌认证
- 基于角色的访问控制
- 项目密码验证机制

### 2. 数据安全
- 密码加密存储
- 敏感数据加密传输
- SQL注入防护
- XSS攻击防护

### 3. 监控与日志
- Sentry前端异常监控
- ELK服务端日志分析
- 关键操作审计日志

## 八、扩展性设计

### 1. 模块化设计
- 功能模块独立封装
- 接口标准化

### 2. 未来扩展方向
- 文件上传功能
- 消息通知系统
- 数据分析报表
- 移动端APP

---

_**User**_

我想使用这个提示，此文档进行cursor开发指导， 你帮我看看合不合适呢？：您是TypeScript、Node.js、NuxtJS、Vue 3、Shadcn Vue、Radix Vue、VueUse和Tailwind的专家。

代码风格和结构
- 使用准确的示例编写简洁的技术TypeScript代码。
- 使用组合API和声明式编程模式，避免使用选项API。
- 避免代码重复，优先使用迭代和模块化。
- 使用具有辅助动词的描述性变量名（例如isLoading，hasError）。
- 文件结构：导出的组件、组合函数、辅助函数、静态内容、类型。

命名约定
- 目录使用小写和破折号（例如components/auth-wizard）。
- 组件名称使用PascalCase（例如AuthWizard.vue）。
- 组合函数使用camelCase（例如useAuthState.ts）。

TypeScript使用
- 所有代码使用TypeScript，优先使用类型而不是接口。
- 避免使用枚举，使用const对象代替。
- 使用带有TypeScript的Vue 3，利用defineComponent和PropType。

语法和格式化
- 使用箭头函数来定义方法和计算属性。
- 避免在条件语句中使用不必要的大括号，对于简单语句使用简洁语法。
- 使用模板语法进行声明式渲染。

UI和样式
- 使用Shadcn Vue、Radix Vue和Tailwind进行组件和样式。
- 使用Tailwind CSS实现响应式设计，采用移动优先的方法。

性能优化
- 利用Nuxt内置的性能优化功能。
- 对于异步组件使用Suspense。
- 对路由和组件实现懒加载。
- 优化图片：使用WebP格式，包含大小数据，实现懒加载。

关键约定
- 使用VueUse提供的常用组合函数和实用函数。
- 使用Pinia进行状态管理。
- 优化Web Vitals（LCP、CLS、FID）。
- 利用Nuxt的自动导入功能导入组件和组合函数。

Nuxt特定指南
- 遵循Nuxt 3的目录结构（例如pages/、components/、composables/）。
- 使用Nuxt的内置功能：
- 组件和组合函数的自动导入。
- 基于文件的路由在pages/目录中。
- 服务器路由在server/目录中。
- 利用Nuxt插件实现全局功能。
- 使用useFetch和useAsyncData进行数据获取。
- 使用Nuxt的useHead和useSeoMeta实现SEO最佳实践。

Vue 3和组合API最佳实践
- 使用<script setup>语法来定义简洁的组件。
- 利用ref、reactive和computed进行响应式状态管理。
- 在适当的情况下使用provide/inject进行依赖注入。
- 实现自定义组合函数以实现可重用逻辑。

请遵循官方的Nuxt.js和Vue.js文档，了解有关数据获取、渲染和路由的最佳实践。

---

_**Assistant**_

<thinking>
用户想要我评估一个提示，看它是否适合用于Cursor开发指导，特别是基于之前我们讨论的流程王项目架构。我需要分析这个提示的内容，并评估它与流程王项目的技术栈和需求的匹配程度。

让我分析一下这个提示的内容和流程王项目的技术栈之间的关系：

流程王项目技术栈：
1. 后台管理系统（Web端）：Vue3 + TypeScript + Element Plus + Vite + Pinia + Vue Router
2. 小程序端：微信小程序原生开发 + TypeScript + Vant Weapp
3. 后端服务：NestJS + MySQL + Redis + TypeORM

用户提供的提示内容主要关注：
1. TypeScript、Node.js、NuxtJS、Vue 3、Shadcn Vue、Radix Vue、VueUse和Tailwind
2. 代码风格和结构规范
3. 命名约定
4. TypeScript使用规范
5. UI和样式（使用Shadcn Vue、Radix Vue和Tailwind）
6. 性能优化
7. 状态管理（Pinia）
8. Nuxt特定指南
9. Vue 3和组合API最佳实践

我需要评估这个提示是否适合用于流程王项目的开发指导。
</thinking>

我看了您提供的开发指导提示，针对流程王项目的技术栈和架构，我有以下评估：

## 匹配点
- **TypeScript和Vue 3**：完全匹配流程王项目的Web端技术栈
- **组合API**：符合现代Vue3开发模式，适合流程王项目
- **Pinia状态管理**：与流程王项目的状态管理方案一致
- **命名约定**：提供了清晰的命名规范，有助于项目代码一致性
- **TypeScript使用规范**：对于全栈TypeScript项目很有帮助

## 不匹配点
- **NuxtJS**：流程王项目使用的是Vue3+Vite而非Nuxt，Nuxt相关的指导（如目录结构、自动导入、useFetch等）不适用
- **UI框架**：提示中推荐Shadcn Vue、Radix Vue和Tailwind，而流程王项目使用的是Element Plus
- **Node.js后端**：提示没有涵盖NestJS相关的最佳实践
- **小程序开发**：提示完全没有涵盖微信小程序开发相关内容

## 建议修改
如果要使用这个提示进行流程王项目的开发指导，我建议做以下调整：

1. **替换UI框架**：将Shadcn Vue、Radix Vue替换为Element Plus
2. **移除Nuxt特定内容**：删除所有Nuxt相关的指导，替换为Vite项目结构指南
3. **添加NestJS部分**：增加NestJS后端开发的最佳实践
4. **添加小程序部分**：增加微信小程序开发的规范和最佳实践
5. **添加项目特定规范**：根据流程王项目的特点，添加项目特定的开发规范

## 总结
这个提示包含了很多优秀的Vue3和TypeScript开发实践，但需要根据流程王项目的具体技术栈进行定制。建议您保留通用的TypeScript、Vue3和代码风格部分，但替换掉特定的框架和库的指导，使其更符合流程王项目的技术选型。

您是否需要我帮您修改这个提示，使其更适合流程王项目的开发指导？

---

_**User**_

 好的，那你帮我改一下

---

_**Assistant**_

<thinking>
我需要修改用户提供的开发指导提示，使其更适合流程王项目的技术栈和架构。我将保留通用的部分，替换不匹配的部分，并添加流程王项目特定的内容。

流程王项目的技术栈回顾：
1. 后台管理系统（Web端）：Vue3 + TypeScript + Element Plus + Vite + Pinia + Vue Router
2. 小程序端：微信小程序原生开发 + TypeScript + Vant Weapp + Canvas/F2 + MobX
3. 后端服务：NestJS + MySQL + Redis + TypeORM + RESTful API

我将按照以下方向修改提示：
1. 保留TypeScript、Vue3的通用最佳实践
2. 替换UI框架部分，从Shadcn Vue/Radix Vue/Tailwind改为Element Plus
3. 移除Nuxt特定内容，替换为Vite项目结构
4. 添加NestJS后端开发指南
5. 添加微信小程序开发指南
6. 调整状态管理部分，包括Pinia(Web端)和MobX(小程序端)
7. 添加项目特定的开发规范

现在开始修改提示。
</thinking>

# 流程王项目开发指导

您是TypeScript、Vue 3、Element Plus、NestJS、微信小程序和相关技术栈的专家，负责指导流程王项目的开发。

## 通用规范

### 代码风格和结构
- 使用准确的示例编写简洁的TypeScript代码。
- 使用组合API和声明式编程模式，避免使用选项API。
- 避免代码重复，优先使用迭代和模块化。
- 使用具有辅助动词的描述性变量名（例如isLoading，hasError）。
- 文件结构：导出的组件、组合函数、辅助函数、静态内容、类型。

### 命名约定
- 目录使用小写和破折号（例如components/project-list）。
- 组件名称使用PascalCase（例如ProjectList.vue）。
- 组合函数使用camelCase（例如useProjectState.ts）。
- API服务使用camelCase（例如projectService.ts）。

### TypeScript使用
- 所有代码使用TypeScript，优先使用类型而不是接口。
- 避免使用枚举，使用const对象代替。
- 使用带有TypeScript的Vue 3，利用defineComponent和PropType。
- 为API响应和请求定义明确的类型。

## Web端开发指南（Vue3 + Element Plus）

### 项目结构
```
admin/
├── src/
│   ├── assets/              # 静态资源
│   ├── components/          # 通用组件
│   │   ├── common/         # 基础UI组件
│   │   └── business/       # 业务组件
│   ├── composables/         # 组合式函数
│   ├── router/              # 路由配置
│   ├── store/               # Pinia状态管理
│   ├── views/               # 页面组件
│   ├── api/                 # API服务
│   ├── utils/               # 工具函数
│   └── types/               # 类型定义
├── vite.config.ts           # Vite配置
└── ...
```

### Vue 3和组合API最佳实践
- 使用`<script setup>`语法来定义简洁的组件。
- 利用ref、reactive和computed进行响应式状态管理。
- 在适当的情况下使用provide/inject进行依赖注入。
- 实现自定义组合函数以实现可重用逻辑。

```typescript
<script setup lang="ts">
// 导入依赖
import { ref, computed, onMounted } from 'vue'
import { useProjectStore } from '@/store/project'
import type { Project } from '@/types/project'

// 定义props
const props = defineProps<{
  projectId?: number
}>()

// 状态管理
const projectStore = useProjectStore()
const isLoading = ref(false)
const error = ref<string | null>(null)

// 计算属性
const projectStatus = computed(() => {
  return projectStore.currentProject?.status || 'not_started'
})

// 生命周期钩子
onMounted(async () => {
  if (props.projectId) {
    isLoading.value = true
    try {
      await projectStore.fetchProject(props.projectId)
    } catch (e) {
      error.value = '加载项目失败'
    } finally {
      isLoading.value = false
    }
  }
})

// 方法
const handleStatusChange = async (status: string) => {
  // 实现状态更新逻辑
}
</script>
```

### Element Plus使用指南
- 使用Element Plus组件库构建管理界面。
- 利用Element Plus的表格、表单、弹窗等组件实现CRUD操作。
- 使用Element Plus的主题定制功能统一项目风格。
- 合理使用布局组件（Container、Row、Col）构建响应式界面。

```vue
<template>
  <el-card class="project-card">
    <template #header>
      <div class="card-header">
        <h3>项目列表</h3>
        <el-button type="primary" @click="handleAddProject">新建项目</el-button>
      </div>
    </template>
    
    <el-table v-loading="isLoading" :data="projects" style="width: 100%">
      <el-table-column prop="name" label="项目名称" />
      <el-table-column prop="startDate" label="开始时间" />
      <el-table-column prop="expectedEndDate" label="预计完成日期" />
      <el-table-column prop="status" label="状态">
        <template #default="{ row }">
          <el-tag :type="getStatusType(row.status)">{{ getStatusText(row.status) }}</el-tag>
        </template>
      </el-table-column>
      <el-table-column label="操作">
        <template #default="{ row }">
          <el-button-group>
            <el-button size="small" @click="handleEdit(row)">编辑</el-button>
            <el-button size="small" type="danger" @click="handleDelete(row)">删除</el-button>
          </el-button-group>
        </template>
      </el-table-column>
    </el-table>
  </el-card>
</template>
```

### 状态管理（Pinia）
- 使用Pinia进行状态管理，按功能模块拆分store。
- 在store中定义清晰的状态、getter和action。
- 使用TypeScript确保类型安全。
- 处理异步操作和API调用。

```typescript
// store/project.ts
import { defineStore } from 'pinia'
import { projectApi } from '@/api/project'
import type { Project, ProjectStatus } from '@/types/project'

export const useProjectStore = defineStore('project', {
  state: () => ({
    projects: [] as Project[],
    currentProject: null as Project | null,
    isLoading: false,
  }),
  
  getters: {
    getProjectById: (state) => (id: number) => {
      return state.projects.find(p => p.id === id)
    },
    completedProjects: (state) => {
      return state.projects.filter(p => p.status === 'completed')
    }
  },
  
  actions: {
    async fetchProjects() {
      this.isLoading = true
      try {
        const data = await projectApi.getProjects()
        this.projects = data
      } catch (error) {
        console.error('获取项目列表失败', error)
        throw error
      } finally {
        this.isLoading = false
      }
    },
    
    async fetchProject(id: number) {
      this.isLoading = true
      try {
        const data = await projectApi.getProject(id)
        this.currentProject = data
      } catch (error) {
        console.error(`获取项目${id}失败`, error)
        throw error
      } finally {
        this.isLoading = false
      }
    }
  }
})
```

## 小程序端开发指南

### 项目结构
```
miniprogram/
├── components/              # 自定义组件
│   ├── common/             # 通用组件
│   └── business/           # 业务组件
├── pages/                   # 页面
│   ├── index/              # 首页（搜索页）
│   ├── project-flow/       # 流程图页面
│   └── ...                 # 其他页面
├── services/                # API服务
├── store/                   # MobX状态管理
├── utils/                   # 工具函数
└── ...
```

### 微信小程序开发最佳实践
- 使用TypeScript增强代码类型安全。
- 使用Vant Weapp组件库构建UI界面。
- 使用MobX-miniprogram进行状态管理。
- 使用Canvas API和F2图表库绘制流程图。

```typescript
// pages/project-flow/index.ts
import { createStoreBindings } from 'mobx-miniprogram-bindings'
import { projectStore } from '../../store/project'

Page({
  data: {
    projectId: 0,
    isLoading: true,
    project: null,
    nodes: [],
  },
  
  onLoad(options) {
    // 创建MobX绑定
    this.storeBindings = createStoreBindings(this, {
      store: projectStore,
      fields: ['currentProject', 'isLoading'],
      actions: ['fetchProject', 'fetchProjectNodes'],
    })
    
    const { id } = options
    if (id) {
      this.setData({ projectId: Number(id) })
      this.loadProjectData(Number(id))
    }
  },
  
  async loadProjectData(id: number) {
    try {
      await this.fetchProject(id)
      await this.fetchProjectNodes(id)
    } catch (error) {
      wx.showToast({
        title: '加载项目数据失败',
        icon: 'none'
      })
    }
  },
  
  onNodeTap(e) {
    const { nodeId } = e.currentTarget.dataset
    // 处理节点点击事件
  },
  
  onUnload() {
    // 清理MobX绑定
    this.storeBindings.destroyStoreBindings()
  }
})
```

### 流程图渲染
- 使用Canvas API绘制流程图节点和连线。
- 使用F2图表库处理复杂图表渲染。
- 实现节点状态的可视化展示。
- 处理触摸事件和交互。

```typescript
// components/flow-chart/index.ts
Component({
  properties: {
    nodes: {
      type: Array,
      value: []
    },
    activeNodeId: {
      type: Number,
      value: 0
    }
  },
  
  data: {
    canvasContext: null
  },
  
  lifetimes: {
    attached() {
      this.initCanvas()
    }
  },
  
  methods: {
    initCanvas() {
      const query = this.createSelectorQuery()
      query.select('#flowChart')
        .fields({ node: true, size: true })
        .exec((res) => {
          const canvas = res[0].node
          const ctx = canvas.getContext('2d')
          this.setData({ canvasContext: ctx })
          this.drawFlowChart()
        })
    },
    
    drawFlowChart() {
      const { nodes, canvasContext: ctx } = this.data
      if (!ctx || !nodes.length) return
      
      // 清空画布
      ctx.clearRect(0, 0, canvas.width, canvas.height)
      
      // 绘制节点和连线
      // ...绘制逻辑
    }
  }
})
```

## 后端开发指南（NestJS）

### 项目结构
```
backend/
├── src/
│   ├── main.ts                # 应用入口
│   ├── app.module.ts          # 根模块
│   ├── modules/               # 功能模块
│   │   ├── auth/             # 认证模块
│   │   ├── users/            # 用户模块
│   │   ├── projects/         # 项目模块
│   │   └── ...               # 其他模块
│   ├── common/                # 公共模块
│   └── database/              # 数据库相关
└── ...
```

### NestJS最佳实践
- 遵循模块化架构，每个功能领域创建独立模块。
- 使用TypeORM进行数据库交互，定义清晰的实体关系。
- 实现RESTful API，使用DTO验证请求数据。
- 使用Guards和Interceptors处理认证和响应转换。

```typescript
// modules/projects/project.entity.ts
import { Entity, Column, PrimaryGeneratedColumn, ManyToOne, OneToMany } from 'typeorm'
import { User } from '../users/user.entity'
import { Node } from '../nodes/node.entity'

@Entity('projects')
export class Project {
  @PrimaryGeneratedColumn()
  id: number

  @Column()
  name: string

  @Column('text')
  deliverables: string

  @Column({ type: 'date' })
  startDate: Date

  @Column()
  daysRequired: number

  @Column({ type: 'date' })
  expectedEndDate: Date

  @Column({
    type: 'enum',
    enum: ['not_started', 'in_progress', 'completed', 'delayed'],
    default: 'not_started'
  })
  status: string

  @Column()
  accessPassword: string

  @ManyToOne(() => User, user => user.projects)
  createdBy: User

  @OneToMany(() => Node, node => node.project)
  nodes: Node[]
}
```

```typescript
// modules/projects/projects.controller.ts
import { Controller, Get, Post, Body, Param, UseGuards } from '@nestjs/common'
import { ProjectsService } from './projects.service'
import { CreateProjectDto } from './dto/create-project.dto'
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard'
import { RolesGuard } from '../auth/guards/roles.guard'
import { Roles } from '../auth/decorators/roles.decorator'

@Controller('api/projects')
@UseGuards(JwtAuthGuard, RolesGuard)
export class ProjectsController {
  constructor(private readonly projectsService: ProjectsService) {}

  @Get()
  @Roles('admin')
  findAll() {
    return this.projectsService.findAll()
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.projectsService.findOne(+id)
  }

  @Post()
  @Roles('admin')
  create(@Body() createProjectDto: CreateProjectDto) {
    return this.projectsService.create(createProjectDto)
  }
}
```

### 数据库和ORM
- 使用TypeORM定义实体和关系。
- 实现数据库迁移和种子数据。
- 使用Repository模式进行数据访问。
- 处理事务和并发。

### API安全性
- 实现JWT认证机制。
- 使用基于角色的访问控制。
- 验证和清理所有用户输入。
- 实现项目密码验证机制。

## 性能优化

### Web端性能优化
- 使用Vite的按需加载和代码分割。
- 优化组件渲染性能，避免不必要的重渲染。
- 实现虚拟滚动处理大量数据。
- 优化图片和静态资源加载。

### 小程序性能优化
- 减少页面初始数据加载量。
- 优化Canvas渲染性能。
- 使用分页加载处理大量数据。
- 合理使用缓存减少网络请求。

### 后端性能优化
- 实现数据缓存策略（Redis）。
- 优化数据库查询和索引。
- 实现API响应压缩。
- 监控和优化服务器资源使用。

## 项目特定规范

### 项目流程管理
- 前置条件、节点、成果的数据结构和关系处理。
- 流程图的渲染和交互逻辑。
- 项目状态和进度计算。

### 安全性考虑
- 项目密码的加密存储和验证。
- 用户认证和授权机制。
- 敏感数据的保护。

### 协作开发
- 使用Git进行版本控制，遵循分支管理策略。
- 编写清晰的提交信息。
- 进行代码审查，确保代码质量。
- 编写单元测试和集成测试。

---

请遵循以上指导进行流程王项目的开发，确保代码质量、性能和安全性。如有特殊需求或技术挑战，请及时沟通和调整开发策略。

---

_**User**_

好的，现在请开始开发，你建议我从哪部分开始？

---

_**Assistant**_

<thinking>
用户希望我提供建议，从哪部分开始开发流程王项目。我需要考虑项目的依赖关系、开发顺序和优先级，给出一个合理的开发路线图。

在软件开发中，通常会先搭建基础架构，然后从核心功能开始开发，逐步扩展到其他功能。对于流程王项目，我需要考虑以下几点：

1. 数据库设计是基础，需要先完成
2. 后端API是前端和小程序的依赖，应该优先开发
3. 核心功能（项目和节点管理）应该优先于次要功能
4. 管理后台（Web端）是创建内容的入口，应该优先于查看内容的小程序端

基于这些考虑，我将给出一个合理的开发顺序建议。
</thinking>

# 流程王项目开发路线建议

基于项目架构和技术栈，我建议按照以下顺序进行开发：

## 第一阶段：基础架构搭建

1. **数据库设计与初始化**
   - 创建MySQL数据库和表结构
   - 设置索引和外键关系
   - 准备基础测试数据

2. **后端项目骨架搭建**
   - 初始化NestJS项目
   - 配置TypeORM连接
   - 设置项目结构和模块划分
   - 实现基础的异常处理和日志系统

3. **Web管理后台骨架搭建**
   - 初始化Vue3项目
   - 配置Element Plus
   - 设置路由和状态管理
   - 实现基础布局和导航

## 第二阶段：核心功能开发

4. **用户认证系统**
   - 后端：实现用户注册、登录API
   - 后端：实现JWT认证和权限控制
   - Web端：实现登录页面和认证状态管理

5. **项目管理功能**
   - 后端：实现项目CRUD API
   - Web端：实现项目列表、创建和编辑页面
   - 实现项目密码设置和验证机制

6. **节点管理功能**
   - 后端：实现节点CRUD API
   - Web端：实现节点列表、创建和编辑页面
   - 实现节点排序和状态管理

7. **问题和材料管理**
   - 后端：实现问题和材料CRUD API
   - Web端：实现问题和材料管理界面

## 第三阶段：小程序开发

8. **小程序基础架构**
   - 初始化微信小程序项目
   - 配置MobX状态管理
   - 实现用户登录和认证

9. **项目搜索和查看**
   - 实现首页搜索功能
   - 实现项目密码验证
   - 实现项目基本信息展示

10. **流程图展示**
    - 实现Canvas流程图渲染
    - 实现节点状态和进度展示
    - 实现节点交互和详情展示

11. **详情页面开发**
    - 实现前置条件详情页
    - 实现材料详情页
    - 实现问题详情页
    - 实现成果展示页

## 第四阶段：优化和部署

12. **性能优化**
    - Web端性能优化
    - 小程序性能优化
    - 后端API性能优化
    - 数据库查询优化

13. **测试和Bug修复**
    - 单元测试和集成测试
    - 用户界面测试
    - Bug修复和功能完善

14. **部署和上线**
    - 配置Docker容器
    - 设置CI/CD流程
    - 生产环境部署
    - 监控和日志系统配置

## 建议从哪里开始

考虑到项目的依赖关系和开发效率，我建议从**数据库设计与后端骨架搭建**开始：

1. 首先创建数据库和表结构，这是整个项目的基础
2. 然后搭建NestJS后端项目，实现基础的用户认证API
3. 接着开发Web管理后台的登录和项目管理功能
4. 逐步扩展到节点、问题和材料管理
5. 最后开发小程序端功能

这样的开发顺序可以确保前后端协同开发，并且在开发过程中可以逐步测试和验证功能。

您想从哪个具体部分开始？我可以帮您搭建数据库结构或初始化后端项目。

---

_**User**_

我想到另外一种方式，你看可行吗？还是你这种方法更好？我比如说我先开始弄好登录的后台界面界面， 先把网页开发出来，但不弄具体的功能网页觉得没问题了，然后我再让你进行具体的功能开发，也就是说一个网页一个网页的搞定这样子可行吗？还是你的方案更好？

---

_**Assistant**_

<thinking>
用户提出了一种不同的开发方式：先开发前端界面（特别是登录和后台界面），把网页框架搭建好，然后再逐个页面实现具体功能。我需要分析这种方法的可行性，并与我之前建议的方法进行比较。

让我分析两种方法的优缺点：

用户提出的方法（先做前端界面，再实现功能）：

优点：
1. 可以快速看到项目的视觉效果，有助于确认UI/UX设计
2. 可以先确定前端的整体结构和导航流程
3. 对于前端开发者来说，可能更有成就感，因为可以看到直观的进展
4. 可以先确定前端组件的复用和页面结构

缺点：
1. 前端开发可能会受到后端API不完整的限制
2. 可能需要使用模拟数据（mock data）
3. 后期集成真实API时可能需要修改前端代码
4. 数据模型的变化可能导致界面需要重新设计

我之前建议的方法（从数据库和后端开始，逐步到前端）：

优点：
1. 遵循依赖关系，减少后期修改
2. 确保数据模型的稳定性
3. 前端开发时已有可用的API
4. 更符合传统的全栈开发流程

缺点：
1. 前期没有可视化的成果
2. 可能延迟获取UI/UX反馈
3. 前后端开发可能不够并行

现在我需要考虑项目的具体情况，给出一个平衡的建议。
</thinking>

# 两种开发方式的比较分析

您提出的方法（先开发前端界面，再实现功能）是完全可行的，这种方法在业界也被称为"UI优先"或"前端驱动"的开发方式。让我分析两种方法的优缺点，然后给您一个建议：

## 您提出的方法（前端界面优先）

**优点：**
- 可以快速看到项目的视觉效果，有助于确认设计方向
- 能够提前发现UI/UX问题，避免后期大改
- 对于展示给客户或团队成员，有直观的进展展示
- 可以先确定前端组件的复用和页面结构

**缺点：**
- 需要使用模拟数据（Mock Data）
- 后期集成真实API时可能需要调整
- 数据模型变化可能导致界面需要修改

## 我之前建议的方法（后端优先）

**优点：**
- 遵循技术依赖关系，减少后期修改
- 确保数据模型的稳定性
- 前端开发时已有可用的API
- 更符合传统的全栈开发流程

**缺点：**
- 前期没有可视化的成果
- 可能延迟获取UI/UX反馈
- 开发周期可能感觉较长

## 折中方案（推荐）

考虑到流程王项目的特点，我建议一个折中的方案：

1. **先完成最基础的数据库设计**（这是不可避免的第一步）
2. **同时开发基础的后端API和前端界面框架**
   - 后端：实现用户认证和基本的项目API
   - 前端：开发登录页面和管理后台框架
3. **然后按模块并行开发**
   - 先完成项目管理模块（前后端）
   - 再完成节点管理模块（前后端）
   - 依次类推

这种方法结合了两种方式的优点：
- 您可以较快看到界面效果
- 同时确保数据模型的稳定性
- 避免后期大量修改
- 可以模块化推进，每完成一个模块就有可用的功能

## 具体实施建议

如果您更倾向于前端优先的方式，我建议：

1. 先用1-2天时间完成数据库基本设计（这是必要的基础）
2. 然后开发前端登录和管理后台框架（使用模拟数据）
3. 同时开发基础的后端API（用户认证）
4. 然后按页面逐个实现：
   - 项目列表页 → 项目创建/编辑页
   - 节点管理页 → 问题/材料管理页
   - 依次类推

这样您可以看到界面进展，同时确保项目的技术基础是稳固的。

您觉得这个折中方案如何？或者您更倾向于完全的前端优先方式？

---

_**User**_

那就按到折中的方案开发吧

---

_**Assistant**_

<thinking>
用户同意采用我建议的折中方案进行开发。这个方案是：
1. 先完成最基础的数据库设计
2. 同时开发基础的后端API和前端界面框架
3. 然后按模块并行开发

现在我需要给用户提供具体的开始步骤，帮助他们启动项目开发。我应该提供：
1. 数据库设计的具体实施步骤
2. 后端项目初始化的步骤
3. 前端项目初始化的步骤
4. 第一个功能模块（用户认证）的开发计划

我会提供详细的指导，包括命令行操作、代码示例和配置文件，以便用户可以直接按照这些步骤开始开发。
</thinking>

# 流程王项目开发启动计划

很好，我们采用折中方案进行开发。下面是具体的启动步骤：

## 第一阶段：基础设施搭建（预计2-3天）

### 1. 数据库设计与创建

首先创建MySQL数据库和基本表结构：

```sql
-- 创建数据库
CREATE DATABASE liuchengwang CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 使用数据库
USE liuchengwang;

-- 创建用户表
CREATE TABLE `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(100) NOT NULL COMMENT '密码（加密存储）',
  `real_name` varchar(50) DEFAULT NULL COMMENT '真实姓名',
  `role` enum('admin','employee') NOT NULL DEFAULT 'employee' COMMENT '角色',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像URL',
  `phone` varchar(20) DEFAULT NULL COMMENT '手机号',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态：1-启用，0-禁用',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

-- 创建项目表
CREATE TABLE `projects` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL COMMENT '项目名称',
  `deliverables` text NOT NULL COMMENT '需交付内容',
  `start_date` date NOT NULL COMMENT '项目开始时间',
  `days_required` int NOT NULL COMMENT '需要完成天数',
  `expected_end_date` date NOT NULL COMMENT '预计完成日期',
  `status` enum('not_started','in_progress','completed','delayed') NOT NULL COMMENT '完成状态',
  `access_password` varchar(100) NOT NULL COMMENT '项目查询密码',
  `created_by` int NOT NULL COMMENT '创建人ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`),
  KEY `idx_status` (`status`),
  KEY `idx_created_by` (`created_by`),
  CONSTRAINT `fk_projects_users` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目表';

-- 创建节点表
CREATE TABLE `nodes` (
  `id` int NOT NULL AUTO_INCREMENT,
  `project_id` int NOT NULL COMMENT '所属项目ID',
  `name` varchar(100) NOT NULL COMMENT '节点名称',
  `description` text COMMENT '节点描述',
  `order` int NOT NULL COMMENT '节点顺序',
  `status` enum('not_started','in_progress','completed') NOT NULL DEFAULT 'not_started' COMMENT '节点状态',
  `expected_end_date` date DEFAULT NULL COMMENT '预计完成日期',
  `actual_end_date` date DEFAULT NULL COMMENT '实际完成日期',
  `node_type` enum('prerequisite','normal','result') NOT NULL DEFAULT 'normal' COMMENT '节点类型：前置条件/普通节点/成果',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_project_id` (`project_id`),
  KEY `idx_order` (`order`),
  CONSTRAINT `fk_nodes_projects` FOREIGN KEY (`project_id`) REFERENCES `projects` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='节点表';

-- 创建问题表和材料表
CREATE TABLE `issues` (
  `id` int NOT NULL AUTO_INCREMENT,
  `node_id` int NOT NULL COMMENT '所属节点ID',
  `description` text NOT NULL COMMENT '问题描述',
  `status` enum('pending','resolved') NOT NULL DEFAULT 'pending' COMMENT '问题状态',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_node_id` (`node_id`),
  CONSTRAINT `fk_issues_nodes` FOREIGN KEY (`node_id`) REFERENCES `nodes` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='问题表';

CREATE TABLE `materials` (
  `id` int NOT NULL AUTO_INCREMENT,
  `node_id` int NOT NULL COMMENT '所属节点ID',
  `name` varchar(100) NOT NULL COMMENT '材料名称',
  `description` text COMMENT '材料说明',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_node_id` (`node_id`),
  CONSTRAINT `fk_materials_nodes` FOREIGN KEY (`node_id`) REFERENCES `nodes` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='材料表';

-- 创建管理员账号
INSERT INTO `users` (`username`, `password`, `real_name`, `role`, `status`)
VALUES ('admin', '$2b$10$X7UXYnRyZJO3L6tYQQHkUuRpwGkJkMzK0CjfGJiBwedYIvS0mJwDO', '系统管理员', 'admin', 1);
-- 注：密码为"admin123"的bcrypt哈希值
```

### 2. 后端项目初始化

创建NestJS项目并配置基本结构：

```bash
# 安装NestJS CLI
npm i -g @nestjs/cli

# 创建项目
nest new backend

# 进入项目目录
cd backend

# 安装依赖
npm install --save @nestjs/typeorm typeorm mysql2 bcrypt class-validator class-transformer @nestjs/jwt @nestjs/passport passport passport-jwt
npm install --save-dev @types/bcrypt @types/passport-jwt
```

### 3. 前端项目初始化

创建Vue3项目并配置Element Plus：

```bash
# 使用Vite创建Vue3项目
npm create vite@latest admin -- --template vue-ts

# 进入项目目录
cd admin

# 安装依赖
npm install
npm install element-plus @element-plus/icons-vue pinia vue-router axios

# 安装开发依赖
npm install --save-dev unplugin-vue-components unplugin-auto-import
```

## 第二阶段：基础功能开发（预计3-4天）

### 1. 后端认证模块开发

首先，我们需要在后端实现基本的用户认证功能：

1. 创建用户模块和实体
2. 实现JWT认证
3. 创建登录和获取用户信息API

### 2. 前端登录页面和布局开发

同时，我们开发前端的登录页面和基本布局：

1. 创建登录页面
2. 实现基本的布局组件（侧边栏、顶部导航）
3. 配置路由和状态管理

### 3. 项目管理模块开发

接下来，我们开发项目管理模块：

1. 后端：实现项目CRUD API
2. 前端：实现项目列表和创建/编辑页面

## 具体开始步骤

让我们从后端和前端的基础设置开始：

### 后端项目设置

1. 创建数据库配置文件 `backend/src/config/database.config.ts`:

```typescript
import { TypeOrmModuleOptions } from '@nestjs/typeorm';

export const databaseConfig: TypeOrmModuleOptions = {
  type: 'mysql',
  host: 'localhost',
  port: 3306,
  username: 'root',  // 替换为您的MySQL用户名
  password: 'password',  // 替换为您的MySQL密码
  database: 'liuchengwang',
  entities: [__dirname + '/../**/*.entity{.ts,.js}'],
  synchronize: false,  // 生产环境设为false
};
```

2. 更新 `backend/src/app.module.ts`:

```typescript
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { databaseConfig } from './config/database.config';
import { UsersModule } from './modules/users/users.module';
import { AuthModule } from './modules/auth/auth.module';

@Module({
  imports: [
    TypeOrmModule.forRoot(databaseConfig),
    UsersModule,
    AuthModule,
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

### 前端项目设置

1. 配置 Vite (`admin/vite.config.ts`):

```typescript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import AutoImport from 'unplugin-auto-import/vite';
import Components from 'unplugin-vue-components/vite';
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers';
import path from 'path';

export default defineConfig({
  plugins: [
    vue(),
    AutoImport({
      resolvers: [ElementPlusResolver()],
    }),
    Components({
      resolvers: [ElementPlusResolver()],
    }),
  ],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      },
    },
  },
});
```

2. 创建路由配置 (`admin/src/router/index.ts`):

```typescript
import { createRouter, createWebHistory, RouteRecordRaw } from 'vue-router';

const routes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('../views/login/index.vue'),
    meta: { requiresAuth: false },
  },
  {
    path: '/',
    component: () => import('../layout/index.vue'),
    redirect: '/dashboard',
    children: [
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('../views/dashboard/index.vue'),
        meta: { title: '仪表盘', requiresAuth: true },
      },
      {
        path: 'projects',
        name: 'Projects',
        component: () => import('../views/projects/index.vue'),
        meta: { title: '项目管理', requiresAuth: true },
      },
    ],
  },
];

const router = createRouter({
  history: createWebHistory(),
  routes,
});

// 路由守卫
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token');
  if (to.meta.requiresAuth && !token) {
    next({ name: 'Login' });
  } else {
    next();
  }
});

export default router;
```

3. 创建状态管理 (`admin/src/store/index.ts`):

```typescript
import { createPinia } from 'pinia';

const pinia = createPinia();

export default pinia;
```

4. 创建用户状态 (`admin/src/store/modules/user.ts`):

```typescript
import { defineStore } from 'pinia';
import { ref } from 'vue';
import { login as loginApi, getUserInfo } from '@/api/auth';

export const useUserStore = defineStore('user', () => {
  const token = ref(localStorage.getItem('token') || '');
  const userInfo = ref<any>(null);
  const isLoading = ref(false);

  const login = async (username: string, password: string) => {
    isLoading.value = true;
    try {
      const res = await loginApi(username, password);
      token.value = res.data.token;
      localStorage.setItem('token', res.data.token);
      return res;
    } finally {
      isLoading.value = false;
    }
  };

  const logout = () => {
    token.value = '';
    userInfo.value = null;
    localStorage.removeItem('token');
  };

  const fetchUserInfo = async () => {
    if (!token.value) return;
    
    isLoading.value = true;
    try {
      const res = await getUserInfo();
      userInfo.value = res.data;
      return res;
    } finally {
      isLoading.value = false;
    }
  };

  return {
    token,
    userInfo,
    isLoading,
    login,
    logout,
    fetchUserInfo,
  };
});
```

## 下一步行动计划

现在我们已经有了基本的项目结构，接下来我们可以：

1. **后端**：实现用户实体和认证模块
2. **前端**：实现登录页面和基本布局

您想先从哪一部分开始？或者您需要我提供更详细的某个部分的实现步骤？

---



---

